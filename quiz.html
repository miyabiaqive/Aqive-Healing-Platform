<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
</head>
<body class="bg-gradient-to-b from-purple-50 to-pink-50">
  <div class="h-screen flex flex-col safe-area-top">
    <!-- Header -->
    <div class="px-6 py-4 flex items-center justify-between">
      <button onclick="navigate('home.html')" class="w-10 h-10 flex items-center justify-center">
        <i class="fas fa-times text-gray-600 text-xl"></i>
      </button>
      <div class="flex-1 mx-4">
        <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
          <div id="progressBar" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-500" style="width: 20%"></div>
        </div>
      </div>
      <span id="stepIndicator" class="text-sm font-medium text-gray-600">1/5</span>
    </div>

    <!-- Content Container -->
    <div id="questionContainer" class="flex-1 flex flex-col px-6 py-8"></div>
  </div>

  <script>
    // ä¸‰å±¤è¦ºå¯Ÿæ¶æ§‹å•é¡Œåº«
    const questions = [
      {
        id: 1,
        layer: 'ç¾è±¡è¦ºå¯Ÿ',
        tag: 'èº«é«”è¨Šè™Ÿ',
        icon: 'ğŸ§˜',
        color: 'from-blue-400 to-blue-500',
        question: 'é€™å¹¾å¤©ï¼Œä½ çš„èº«é«”æœ€å¸¸å‡ºç¾å“ªç¨®è¨Šè™Ÿï¼Ÿ',
        subtitle: 'é¸æ“‡æœ€è²¼è¿‘ä½ æ„Ÿå—çš„é¸é …',
        options: [
          { emoji: 'ğŸ˜´', title: 'ç¡ä¸å¥½ï¼å¤±çœ ', value: 'sleep_issue', pattern: 'nervous_arousal' },
          { emoji: 'ğŸ˜«', title: 'é ­ç—›è‚©é ¸ç·Šç¹ƒ', value: 'tension', pattern: 'mental_overload' },
          { emoji: 'ğŸ˜®â€ğŸ’¨', title: 'èƒ¸æ‚¶å‘¼å¸æ€¥ä¿ƒ', value: 'breath_tight', pattern: 'nervous_arousal' },
          { emoji: 'ğŸ˜”', title: 'ç–²å€¦æ²’å‹•åŠ›', value: 'fatigue', pattern: 'energy_depleted' },
          { emoji: 'ğŸ¤”', title: 'èº«é«”é‚„å¥½ï¼Œä½†å¿ƒå¾ˆç´¯', value: 'mental_tired', pattern: 'mental_overload' }
        ]
      },
      {
        id: 2,
        layer: 'æƒ…å¢ƒè¦ºå¯Ÿ',
        tag: 'å£“åŠ›ä¾†æº',
        icon: 'ğŸ’¼',
        color: 'from-purple-400 to-pink-400',
        question: 'é€™æ®µæ™‚é–“ï¼Œè®“ä½ æœ€ç„¦æ…®çš„æƒ…å¢ƒæ˜¯å“ªä¸€é¡ï¼Ÿ',
        subtitle: 'èª å¯¦åœ°é¢å°è‡ªå·±çš„æ„Ÿå—',
        options: [
          { emoji: 'ğŸ¯', title: 'å·¥ä½œç›®æ¨™å£“åŠ›', value: 'work_pressure', pattern: 'mental_overload' },
          { emoji: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§', title: 'å®¶åº­é—œä¿‚ç·Šå¼µ', value: 'family_stress', pattern: 'external_entanglement' },
          { emoji: 'ğŸ’¬', title: 'äººéš›æºé€šå¡ä½', value: 'communication', pattern: 'external_entanglement' },
          { emoji: 'â“', title: 'è‡ªæˆ‘æ‡·ç–‘ï¼æ–¹å‘è¿·æƒ˜', value: 'self_doubt', pattern: 'inner_unfocused' },
          { emoji: 'ğŸ˜Œ', title: 'ç›®å‰å£“åŠ›é‚„å¥½', value: 'low_stress', pattern: 'balanced' }
        ]
      },
      {
        id: 3,
        layer: 'æ ¹æºè¦ºå¯Ÿ',
        tag: 'å…§åœ¨ç‹€æ…‹',
        icon: 'ğŸ’­',
        color: 'from-green-400 to-teal-400',
        question: 'ç•¶ä½ ç¨è™•æ™‚ï¼Œæœ€å¸¸æµ®ç¾çš„æ„Ÿå—æ˜¯ï¼Ÿ',
        subtitle: 'è®“æ½›æ„è­˜çš„è²éŸ³è¢«è½è¦‹',
        options: [
          { emoji: 'ğŸ˜°', title: 'ç„¡æ³•æ”¾é¬†ï¼Œè…¦è¢‹åœä¸ä¸‹ä¾†', value: 'cant_relax', pattern: 'mental_overload' },
          { emoji: 'ğŸ˜¤', title: 'è¢«æœŸå¾…ç¶ä½ï¼Œå–˜ä¸éæ°£', value: 'trapped', pattern: 'external_entanglement' },
          { emoji: 'ğŸ˜¶', title: 'ç©ºè™›ï¼Œä¸çŸ¥é“ç‚ºä½•è€Œåš', value: 'empty', pattern: 'energy_depleted' },
          { emoji: 'ğŸ˜Ÿ', title: 'å°æœªä¾†ç„¦æ…®ï¼Œç¼ºä¹å®‰å…¨æ„Ÿ', value: 'anxious_future', pattern: 'nervous_arousal' },
          { emoji: 'ğŸŒ±', title: 'æƒ³é‡æ–°é–‹å§‹ä½†ä¸çŸ¥å¾ä½•ä¸‹æ‰‹', value: 'restart', pattern: 'inner_unfocused' }
        ]
      },
      {
        id: 4,
        layer: 'æ”¾é¬†æ„è±¡',
        tag: 'æ·±å±¤éœ€æ±‚',
        icon: 'ğŸŒŠ',
        color: 'from-orange-400 to-yellow-400',
        question: 'ç•¶ä½ æƒ³åˆ°ã€Œæ”¾é¬†ã€æ™‚ï¼Œè…¦ä¸­ç¬¬ä¸€å€‹ç•«é¢æ˜¯ï¼Ÿ',
        subtitle: 'è·Ÿéš¨ç›´è¦ºé¸æ“‡',
        options: [
          { emoji: 'ğŸ˜´', title: 'ç¡è¦ºï¼ä¼‘æ¯', value: 'sleep', pattern: 'energy_depleted' },
          { emoji: 'âœˆï¸', title: 'æ—…è¡Œï¼æ›å€‹ç’°å¢ƒ', value: 'travel', pattern: 'external_entanglement' },
          { emoji: 'ğŸ“µ', title: 'é—œæ‰æ‰‹æ©Ÿï¼æ–·é–‹é€£çµ', value: 'disconnect', pattern: 'mental_overload' },
          { emoji: 'ğŸ§˜', title: 'éœåï¼å†¥æƒ³', value: 'meditation', pattern: 'balanced' },
          { emoji: 'ğŸ˜', title: 'æ²’è¾¦æ³•æ”¾é¬†', value: 'cant_relax_visual', pattern: 'nervous_arousal' }
        ]
      },
      {
        id: 5,
        layer: 'ç™‚ç™’æ„åœ–',
        tag: 'è¡Œå‹•æœŸå¾…',
        icon: 'âœ¨',
        color: 'from-pink-400 to-purple-400',
        question: 'å¦‚æœæœ‰ä¸€å€‹è²éŸ³èƒ½å¹«ä½ å›ä¾†ï¼Œä½ å¸Œæœ›å®ƒå¹«ä½ åšä»€éº¼ï¼Ÿ',
        subtitle: 'é€™æ˜¯ä½ å…§åœ¨æœ€æ·±çš„æ¸´æœ›',
        options: [
          { emoji: 'ğŸ¤«', title: 'è®“æˆ‘éœä¸‹ä¾†', value: 'calm_down', pattern: 'nervous_arousal' },
          { emoji: 'ğŸ§­', title: 'å¹«æˆ‘é‡æ¸…æ–¹å‘', value: 'find_direction', pattern: 'inner_unfocused' },
          { emoji: 'ğŸŒ¬ï¸', title: 'æé†’æˆ‘é‚„åœ¨å‘¼å¸', value: 'breathe', pattern: 'mental_overload' },
          { emoji: 'ğŸ’—', title: 'è®“æˆ‘é‡æ–°æ„Ÿè¦ºåˆ°è‡ªå·±', value: 'feel_self', pattern: 'energy_depleted' },
          { emoji: 'ğŸ›¡ï¸', title: 'å¹«æˆ‘å»ºç«‹ç•Œé™', value: 'boundaries', pattern: 'external_entanglement' }
        ]
      }
    ];

    let currentQuestion = 0;
    let responses = {};
    let patternScores = {
      mental_overload: 0,     // é ­è…¦éè¼‰å‹
      nervous_arousal: 0,     // ç¥ç¶“äº¢å¥®å‹
      energy_depleted: 0,     // èƒ½é‡è€—ç«­å‹
      external_entanglement: 0, // å¤–éƒ¨ç³¾çµå‹
      inner_unfocused: 0,     // å…§åœ¨å¤±ç„¦å‹
      balanced: 0             // å¹³è¡¡å‹
    };

    function renderQuestion() {
      const q = questions[currentQuestion];
      const container = document.getElementById('questionContainer');
      
      container.innerHTML = `
        <!-- Question -->
        <div class="mb-6">
          <span class="px-3 py-1 bg-purple-100 text-purple-600 rounded-full text-xs font-medium">${q.layer} Â· ${q.tag}</span>
          <h1 class="text-2xl font-bold text-gray-800 mt-4 mb-2">${q.question}</h1>
          <p class="text-gray-500 text-sm">${q.subtitle}</p>
        </div>

        <!-- Visual -->
        <div class="flex justify-center mb-6">
          <div class="w-28 h-28 bg-gradient-to-br ${q.color} rounded-full blob flex items-center justify-center shadow-lg">
            <span class="text-6xl">${q.icon}</span>
          </div>
        </div>

        <!-- Options -->
        <div class="space-y-3 mb-6 flex-1 overflow-y-auto">
          ${q.options.map((opt, idx) => `
            <button onclick="selectOption(${idx})" class="option-btn w-full p-4 bg-white rounded-2xl text-left shadow-sm transition-smooth hover:shadow-md hover:scale-102 active:scale-98">
              <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center flex-shrink-0">
                  <span class="text-2xl">${opt.emoji}</span>
                </div>
                <div class="flex-1">
                  <h3 class="font-bold text-gray-800 text-sm">${opt.title}</h3>
                </div>
              </div>
            </button>
          `).join('')}
        </div>

        <!-- Navigation Hint -->
        <div class="text-center text-gray-400 text-xs">
          é¸æ“‡ä¸€å€‹é¸é …å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€é¡Œ
        </div>
      `;
    }

    function selectOption(optionIndex) {
      const q = questions[currentQuestion];
      const selected = q.options[optionIndex];
      
      // è¨˜éŒ„å›ç­”
      responses[`q${q.id}`] = {
        question: q.question,
        answer: selected.title,
        value: selected.value,
        pattern: selected.pattern
      };
      
      // ç´¯ç©æ¨¡å¼åˆ†æ•¸
      patternScores[selected.pattern]++;
      
      // è¦–è¦ºåé¥‹
      const buttons = document.querySelectorAll('.option-btn');
      buttons[optionIndex].classList.add('border-2', 'border-purple-500');
      
      // çŸ­æš«å»¶é²å¾Œé€²å…¥ä¸‹ä¸€é¡Œ
      setTimeout(() => {
        currentQuestion++;
        
        if (currentQuestion < questions.length) {
          updateProgress();
          renderQuestion();
        } else {
          completeQuiz();
        }
      }, 300);
    }

    function updateProgress() {
      const progress = ((currentQuestion + 1) / questions.length) * 100;
      document.getElementById('progressBar').style.width = progress + '%';
      document.getElementById('stepIndicator').textContent = `${currentQuestion + 1}/${questions.length}`;
    }

    function completeQuiz() {
      // åˆ¤å®šä¸»è¦èƒ½é‡æ¨¡å¼
      const dominantPattern = Object.keys(patternScores).reduce((a, b) => 
        patternScores[a] > patternScores[b] ? a : b
      );
      
      // å„²å­˜çµæœ
      localStorage.setItem('aqive_quiz_responses', JSON.stringify(responses));
      localStorage.setItem('aqive_energy_pattern', dominantPattern);
      localStorage.setItem('aqive_pattern_scores', JSON.stringify(patternScores));
      
      // é€²å…¥çµæœé 
      navigate('quiz-result.html');
    }

    function navigate(page) {
      if (window.parent !== window) {
        window.parent.postMessage({ type: 'navigate', page: page }, '*');
      } else {
        window.location.href = page;
      }
    }

    // åˆå§‹åŒ–
    renderQuestion();
  </script>
</body>
</html>

